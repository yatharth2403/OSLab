<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OPR | Page Repacement Algorithms</title>
    <link rel="stylesheet" href="oprstyle.css">
    <link rel="stylesheet" href="input.css">
    
    <script>
        class optimal{
    constructor(capacity){
        this.capacity=capacity;
        this.pageFaults=0;
        this.pageHits=0;
        this.searchIndex=-1;
        this.frames=[];
        this.sr=[]   
    }
    refer(token,remaining){
        this.searchIndex=this.frames.indexOf(token);
        if(this.searchIndex!=-1){
            this.pageHits++;
        }
        else{
            this.pageFaults++;
            if(this.capacity==this.frames.length){
                let t=this.sr.indexOf(-1);
                if(t==-1){
                    t=this.sr.indexOf(Math.max(...this.sr));
                }
                this.frames[t]=token;
                if(remaining.indexOf(token)==-1)this.sr[t]=-1;
                else this.sr[t]=this.frames.length+1+remaining.indexOf(token);
            }
            else{
                if(remaining.indexOf(token)==-1)this.sr.push(-1);
                else this.sr.push(this.frames.length+1+remaining.indexOf(token));
                this.frames.push(token);
            }
        }
    }
}
document.getElementById("Submit").addEventListener("click",OPTIMAL);
function OPTIMAL(){
    let res = document.getElementById("input1").value.split(" ");
    let frames = document.getElementById("input2").value;
    let ref=[];
    for (let i = 0; i < res.length; i++) {
        if (res[i] != " " && res[i] != "") {
            ref.push(res[i]);
        }
    }

    createTable("table",frames,ref);
    let obj = new optimal(frames);
    for(let i=0;i<ref.length;i++){
        obj.refer(ref[i],ref.slice(i+1));
        fillcol("table",i+1,obj.frames,frames,obj.searchIndex);
    
    summary('summary',obj.pageFaults,obj.pageFaults+obj.pageHits,frames);
}
function fillcol(tablename,col,objframes,n,searchindex){
    for(let i=1;i<=objframes.length;i++){
        let cell=document.getElementById(tablename+i+''+col);
        cell.innerHTML=objframes[i-1];
    }
    n++;
    let cell=document.getElementById(tablename+n+''+col);
    if(searchindex==-1)cell.innerHTML="MISS";
    else{
        // console.log(tablename+n+''+col); 
        cell.innerHTML="HIT";
        document.getElementById(tablename+(searchindex+1)+''+col).classList.add("bg-success","text-white");
    }
}
function createTable(tablename,frames,ref){
    document.getElementById(tablename).innerHTML="";
    let table = '<tr class="font-weight-bold"><td  id="'+tablename+'00">Reference</td>';
    for (let i = 0; i < ref.length; i++) {
        table += '<td id="'+tablename+'0'+(i+1) + '">' + ref[i] + "</td>";
    }
    table += "</tr>";
    for (let i = 0; i < frames; i++) {
        table += '<tr><td class="font-weight-bold" id="' +tablename+ (i + 1) + '0">Frame ' + (i + 1) + "</td>";
        for (let j = 0; j < ref.length; j++) {
            table += '<td id="'+tablename + (i + 1) + (j + 1) + '"></td>';
        }
        table += "</tr>";
    }
    frames++;
    table += '<tr><td class="font-weight-bold" id="' +tablename+ frames + '0">Status</td>';
    for (var j = 1; j <= ref.length; j++) {
        table += '<td id="' +tablename+ frames + j + '"></td>';
    }
    table += "</tr>";
    console.log(table);
    document.getElementById(tablename).innerHTML += table;
}

function summary(id,pagefaults,pages,frames){
    let summary ="";
    let missratio=(pagefaults / pages).toPrecision(2);
    summary+=`<div>Pages:${pages}</div>`;
    summary+=`<div>Frames:${frames}</div>`;
    summary+=`<div>Hits:${pages-pagefaults}</div>`;
    summary+=`<div>Faults:${pagefaults}</div>`; 
    summary+=`<div>Hit Ratio:${(1-missratio).toPrecision(2)}</div>`; 
    summary+=`<div>Miss Ratio:${missratio}</div>`;
    document.getElementById(id).innerHTML=summary;
}
    </script>
</head>
<body>
    <!--NAVBAR-->
    <div class="navbar">
        <div class="container flex">
            <h1><a href="home.html" title="Home">OS Project</a></h1>
                <nav>
                    <ul>
                        <li class>
                            <a href="index.html">PRA</a>  
                        </li>             
                        <li class>            
                            <a href="fifo.html" title="FIFO">FIFO</a>
                        </li>
                        <li class>                                                      
                            <a href="lifo.html" title="LIFO">LIFO</a> 
                        </li>
                        <li class>            
                            <a href="lru.html"  title="LRU">LRU</a>
                        </li>                        
                    </ul>
                </nav>
        </div>
    </div>

    <hr>

    <!--SHOWCASE-->
    <section class="showcase">
        <div class="container">
            <div class="showcase-text slide-right">
                <h1 id="heading">Optical Page Replacement</h1>
                <p class="lrspc">
                    Optimal Page Replacement algorithm is the best page replacement algorithm as it produces the least number of page faults. 
                    It substitutes the page that will be referred to by the CPU for the longest duration in the future. OPR is used to measure 
                    the performance of other algorithms.
                </p>
            </div>   
            <!--<img src="image.jpg" id="icon" alt="image">-->
        </div>
    </section>

       <!-- Page Content -->
       <section class="page-content">
        <div class="container">
            <h2 class="text-center pu wspc">Advantages</h2>
                <ul>
                    <li class="size-2 lrspc">Excellent efficiency</li>
                    <li class="size-2 lrspc">Simple data structures can be used to implement</li>                   
                    <li class="size-2 lrspc">Less complexity</li>
                </ul> 
            <h2 class="text-center pu wspc">Disadvantages</h2>
                <ul>
                    <li class="size-2 lrspc">Future program knowledge is required, which is not always possible.</li>
                    <li class="size-2 lrspc">Error management is difficult.</li>
                    <li class="size-2 lrspc">Time Consuming</li>
                </ul>
            <h2 class="text-center pu wspc">Example</h2>
                <p class="lrspc">Example: Consider the Pages referenced by the CPU in the order are 3, 1, 2, 1, 6, 5, 1, 3</p>
                <img class="dis" src="oprex.jpg" id="icon" alt="image">
                <p class="lrspc">
                    As in the above figure shown, let there are 3 frames in the memory.
                    <ul class="size-2 lrspc">
                        <li>Initially, since all the slots are empty, pages 3, 1, 2 cause a page fault and take the empty slots.</li>
                        <li>When page 1 comes, it is in the memory and no page fault occurs.</li>
                        <li>When page 6 comes, it is not in the memory, so a page fault occurs and 2 is removed as it is not going to be used again.</li>
                        <li>When page 5 comes, it is also not in the memory and causes a page fault. Similar to above 6 is removed as it is not going to be used again.</li>
                        <li>When page 1 and page 3 come, they are in the memory so no page fault occurs.</li>
                    </ul>
                    <p class="lrspc">The number of Page Faults = 5</p>
                </p>
        </div>
        <div class="inputfromuser" id = "input">
            <br>
            <br>
            <br>
            <h1 class="container text-center" id = "example-heading">Working example</h2>
            <input id="input1" type="text" placeholder = "Enter reference String">
            <br>
            <input id="input2" type="number" placeholder = "Enter number of frames">
            <br>
            <button onClick="OPTIMAL()" id="Submit">Click to Visualize!</button>
           
            <br>
            <div>
                <br>
                <table id="table" class="container text-center">
                </table>
                <br>
				<br>
				<div id="summary" class="container text-center" class="d-flex justify-content-around font-weight-bold text-uppercase"> </div>
               
	        </div>
        <div class="container"></div>
    </section> 
</body>
</html>
}